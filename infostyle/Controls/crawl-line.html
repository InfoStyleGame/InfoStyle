<polymer-element name="crawl-line">
    <template>
        <style>
            @-webkit-keyframes scroll {
                0% {
                    -webkit-transform: translate(0, 0);
                    transform: translate(0, 0);
                }

                100% {
                    -webkit-transform: translate(-100%, 0);
                    transform: translate(-100%, 0);
                }
            }

            @-moz-keyframes scroll {
                0% {
                    -moz-transform: translate(0, 0);
                    transform: translate(0, 0);
                }

                100% {
                    -moz-transform: translate(-100%, 0);
                    transform: translate(-100%, 0);
                }
            }

            @keyframes scroll {
                0% {
                    transform: translate(0, 0);
                }

                100% {
                    transform: translate(-100%, 0);
                }
            }


            .marquee {
                display: block;
                width: 100%;
                white-space: nowrap;
                overflow: hidden;
            }

            .marquee .crawlLineContent {
                display: inline-block;
                padding-left: 100%;
                -webkit-animation: scroll 20s infinite linear;
                -moz-animation: scroll 20s infinite linear;
                animation: scroll 20s infinite linear;
            }
        </style>
        <div class="marquee" on-tap="{{clickAction}}">
            <div class="crawlLineCounters">
                <span>Баллы: <span id="points">{{points}}</span></span>
            </div>
            <div id="text" class="crawlLineContent">
            </div>
        </div>
    </template>
    <script>
        Polymer({
            ready: function () {
                var self = this;
                Api.GetTask(TaskTypes.CrawlLine, Subjects.Stop).done(function (task) {
                    self.data = task.Data.Text;
                    self.init();
                });
                this.points = 0;
            },

            init: function() {
                var text = this.$.text;
                for (var i = 0; i < this.data.length; i++) {
                    var word = this.buildWord(this.data[i]);
                    text.appendChild(word);
                }
            },

            buildWord: function(datum) {
                if (datum.Type == TextTypes.Normal) {
                    return $("<span/>").text(datum.Text)[0];
                } else if (datum.Type == TextTypes.Stop) {
                    return $("<paper-button>/>").attr("on-tap", "{{clickAction}}").addClass("stopWord").text(datum.Text)[0];
                } else {
                    console.warn("Unknown text type" + datum.Type);
                    return $("<span/>")[0];
                }
            },

            clickAction: function(e) {
                var t = e.target;
                if (t.localName === 'paper-button') {
                    this.points++;
                } else {
                    if(this.points > 0)
                        this.points--;
                }
            }
        });
</script>
</polymer-element>