<polymer-element name="login-frame">
    <link href="/Scripts/polymer/paper-button/paper-button.html" rel="import" />
    <template>
        <style>
            .content {
                position: absolute;
                top: 100px;
                left: 50%;
                margin-left: -175px;
                border-radius: 10px;
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                display: inline-block;
                width: 350px;
                background: #fff;
            }
            h1 {
                font-family: Lora;
                font-weight: normal;
                font-style: italic;
                color: #ffffff;
                text-align: center;
                margin: 0;
                padding: 20px;
                background-color: #C48FFF;
                border-radius: 10px 10px 0 0;
            }

            .button-container {
                padding: 50px 10px;
                text-align: center;
            }

            .button-container p {
                font-family: RobotoDraft;
                font-size: 25px;
                line-height: 1.5em;
            }

            .background {
                position: fixed;
                width: 100%;
                height: 100%;
                opacity: 0.7;
                background-color: #000;
            }

            paper-button {
                margin-top: 40px;
                text-transform: none;
                font-family: Lora;
                font-size: 16px;
                font-style: italic;
                color: #fff;
                background-color: #006caa;
            }

            paper-button / deep/ .button-content {
                               padding: 15px 30px 15px 30px;
                           }
        </style>
            <template if="{{loginVisible}}">
                <div class="background"></div>
                <div class="content">
                    <div id="loginstatus"></div>
                    <div class="button-container">
                        <p>Научитесь писать без&nbsp;лишних слов</p>
                        <paper-button id="login" on-click="{{logIn}}" raised>Войти через ВКонтакте</paper-button>
                    </div>
                </div>
            </template>
        </template>
    <script src="http://vk.com/js/api/openapi.js"></script>
    <script>
        Polymer({
            loginVisible: false,
            ready: function () {
                VK.init({
                    apiId: 4793375
                });
                var _this = this;
                //todo Valera: here it is, listener to 'event' on unauthorized
                setInterval(function() {
                    if (window.requireAuthorization) {
                        _this.loginVisible = true;
                    }
                }, 300);
            },

            logIn: function () {
                this.vkLogin(function () { window.location.reload(); }, function () { alert("Can't login"); });
            },

            vkLogin: function(onSuccess, onError) {
                window.VK.Auth.login(function (response) {
                    if (response.session) {
                        onSuccess();
                    } else {
                        onError();
                    }
                });
            }


        });
       

        

        
    </script>
</polymer-element>